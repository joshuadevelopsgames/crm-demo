<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="CRM" />
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="mobile-web-app-capable" content="yes" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Apple Touch Icons - Using iOS app icon (critical for Add to Home Screen) -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png" />
    <link rel="shortcut icon" href="/favicon.ico" />
    
    <style>
      html, body {
        background-color: #ffffff !important;
        margin: 0;
        padding: 0;
        width: 100%;
        min-height: 100%;
        overscroll-behavior: none;
        overscroll-behavior-y: none;
        -webkit-overflow-scrolling: touch;
      }
      
      /* Dark mode support */
      @media (prefers-color-scheme: dark) {
        html:not([data-theme="light"]):not(.light), 
        body:not([data-theme="light"]) {
          background-color: hsl(222, 22%, 8%) !important;
        }
        #root:not([data-theme="light"]) {
          background-color: hsl(222, 22%, 8%);
        }
      }
      
      html.dark, html[data-theme="dark"] {
        background-color: hsl(222, 22%, 8%) !important;
      }
      html.dark body, html[data-theme="dark"] body {
        background-color: hsl(222, 22%, 8%) !important;
      }
      html.dark #root, html[data-theme="dark"] #root {
        background-color: hsl(222, 22%, 8%);
      }
      
      /* Ensure white background extends to top for iPhone notch - only for PWA */
      @media (display-mode: standalone) {
        html {
          padding-top: 0;
          background-color: #ffffff !important;
        }
        body {
          padding-top: 0;
          background-color: #ffffff !important;
        }
        body::before {
          content: '';
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          height: env(safe-area-inset-top, 44px);
          background-color: #ffffff !important;
          z-index: 9997;
          pointer-events: none;
        }
        
        /* Dark mode for PWA */
        @media (prefers-color-scheme: dark) {
          html:not([data-theme="light"]):not(.light) {
            background-color: hsl(222, 22%, 8%) !important;
          }
          html:not([data-theme="light"]):not(.light) body {
            background-color: hsl(222, 22%, 8%) !important;
          }
          html:not([data-theme="light"]):not(.light) body::before {
            background-color: hsl(222, 22%, 8%) !important;
          }
        }
        html.dark, html[data-theme="dark"] {
          background-color: hsl(222, 22%, 8%) !important;
        }
        html.dark body, html[data-theme="dark"] body {
          background-color: hsl(222, 22%, 8%) !important;
        }
        html.dark body::before, html[data-theme="dark"] body::before {
          background-color: hsl(222, 22%, 8%) !important;
        }
      }
      
      /* Ensure root background */
      #root {
        background-color: #ffffff;
        width: 100%;
        min-height: 100%;
      }
    </style>
    <script>
      // Check for dark mode preference and apply immediately
      (function() {
        const savedDarkMode = localStorage.getItem('darkMode');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const isDarkMode = savedDarkMode !== null ? savedDarkMode === 'true' : prefersDark;
        
        if (isDarkMode) {
          document.documentElement.setAttribute('data-theme', 'dark');
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.setAttribute('data-theme', 'light');
          document.documentElement.classList.remove('dark');
        }
      })();
      
      // Set background immediately to prevent black screen
      (function() {
        const savedDarkMode = localStorage.getItem('darkMode');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const isDarkMode = savedDarkMode !== null ? savedDarkMode === 'true' : prefersDark;
        const bgColor = isDarkMode ? 'hsl(222, 22%, 8%)' : '#ffffff';
        
        if (document.documentElement) {
          document.documentElement.style.backgroundColor = bgColor;
        }
        if (document.body) {
          document.body.style.backgroundColor = bgColor;
        } else {
          // Wait for body to be available
          document.addEventListener('DOMContentLoaded', function() {
            if (document.body) {
              document.body.style.backgroundColor = bgColor;
            }
            // Also update loading screen background (only if dark mode is active)
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
              if (isDarkMode) {
                loadingScreen.style.backgroundColor = bgColor;
              } else {
                loadingScreen.style.backgroundColor = '#ffffff';
              }
            }
          });
        }
        
        // Update loading screen background immediately if it exists (only if dark mode is active)
        const updateLoadingScreen = () => {
          const loadingScreen = document.getElementById('loading-screen');
          if (loadingScreen) {
            if (isDarkMode) {
              loadingScreen.style.backgroundColor = bgColor;
            } else {
              loadingScreen.style.backgroundColor = '#ffffff';
            }
          }
        };
        
        // Try immediately
        updateLoadingScreen();
        
        // Also try after DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', updateLoadingScreen);
        } else {
          updateLoadingScreen();
        }
      })();
    </script>
    <title>CRM</title>
  </head>
  <body>
    <!-- Loading Screen - Shows immediately before React loads -->
    <div id="loading-screen" style="position: fixed !important; inset: 0 !important; z-index: 99999 !important; background-color: #ffffff !important; display: flex !important; flex-direction: column !important; align-items: center !important; justify-content: center !important; padding-top: env(safe-area-inset-top, 0px) !important; padding-bottom: env(safe-area-inset-bottom, 0px) !important; padding-left: env(safe-area-inset-left, 0px) !important; padding-right: env(safe-area-inset-right, 0px) !important; visibility: visible !important; opacity: 1 !important;">
      <div style="margin-bottom: 2rem; display: flex; align-items: center; gap: 0.75rem;">
        <div style="position: relative; width: 4rem; height: 4rem; display: flex; align-items: center; justify-content: center;">
          <svg width="64" height="64" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: #0f172a;">
            <!-- Atom nucleus (center circle) -->
            <circle cx="50" cy="50" r="6" fill="currentColor" />
            <!-- Electron orbits (3 elliptical paths) -->
            <!-- Orbit 1 - Horizontal -->
            <ellipse cx="50" cy="50" rx="32" ry="18" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7" />
            <!-- Electron on orbit 1 -->
            <circle cx="82" cy="50" r="3.5" fill="currentColor" />
            <!-- Orbit 2 - Rotated 60 degrees -->
            <ellipse cx="50" cy="50" rx="32" ry="18" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7" transform="rotate(60 50 50)" />
            <!-- Electron on orbit 2 -->
            <circle cx="66" cy="34" r="3.5" fill="currentColor" />
            <!-- Orbit 3 - Rotated 120 degrees -->
            <ellipse cx="50" cy="50" rx="32" ry="18" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7" transform="rotate(120 50 50)" />
            <!-- Electron on orbit 3 -->
            <circle cx="34" cy="66" r="3.5" fill="currentColor" />
          </svg>
        </div>
        <span class="loading-title" style="font-size: 1.875rem; font-weight: 700; background: linear-gradient(to right, #0f172a, #475569); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
          CRM
        </span>
      </div>
      <div style="position: relative;">
        <div class="spinner-track" style="width: 3rem; height: 3rem; border: 4px solid #e2e8f0; border-radius: 9999px;"></div>
        <div class="spinner-active" style="width: 3rem; height: 3rem; border: 4px solid #0f172a; border-top-color: transparent; border-radius: 9999px; position: absolute; top: 0; left: 0; animation: spin 1s linear infinite;"></div>
      </div>
      <p class="loading-text" style="margin-top: 1.5rem; color: #475569; font-size: 0.875rem; font-weight: 500;">Loading...</p>
    </div>
    <style>
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      /* Dark mode support for loading screen - ONLY via explicit theme attribute/class, NOT system preference */
      /* Removed @media (prefers-color-scheme: dark) to prevent system preference from overriding app setting */
      
      /* Dark mode via class (for localStorage preference) */
      html.dark #loading-screen,
      html[data-theme="dark"] #loading-screen {
        background-color: hsl(222, 22%, 8%) !important;
      }
      html.dark #loading-screen .loading-text,
      html[data-theme="dark"] #loading-screen .loading-text {
        color: hsl(215, 15%, 70%) !important;
      }
      html.dark #loading-screen .loading-title,
      html[data-theme="dark"] #loading-screen .loading-title {
        background: linear-gradient(to right, hsl(210, 30%, 96%), hsl(215, 15%, 70%)) !important;
        -webkit-background-clip: text !important;
        -webkit-text-fill-color: transparent !important;
        background-clip: text !important;
      }
      html.dark #loading-screen .spinner-track,
      html[data-theme="dark"] #loading-screen .spinner-track {
        border-color: hsl(222, 20%, 14%) !important;
      }
      html.dark #loading-screen .spinner-active,
      html[data-theme="dark"] #loading-screen .spinner-active {
        border-color: hsl(210, 30%, 96%) !important;
        border-top-color: transparent !important;
      }
    </style>
    <div id="root"></div>
    <script>
      // Ensure loading screen is visible immediately when HTML loads
      (function() {
        console.log('üöÄ HTML loaded, initializing app...');
        console.log('User agent:', navigator.userAgent);
        console.log('Platform:', navigator.platform);
        
        const loadingScreen = document.getElementById('loading-screen');
        const root = document.getElementById('root');
        
        console.log('Loading screen element:', loadingScreen);
        console.log('Root element:', root);
        
        if (loadingScreen) {
          loadingScreen.style.display = 'flex';
          loadingScreen.style.opacity = '1';
          loadingScreen.style.visibility = 'visible';
          loadingScreen.style.zIndex = '99999';
          console.log('‚úÖ Loading screen made visible');
        } else {
          console.error('‚ùå Loading screen element not found!');
        }
        
        // Set body background immediately (respect dark mode)
        // Default to light mode, only use dark if explicitly set
        const savedDarkMode = localStorage.getItem('darkMode');
        const isDarkMode = savedDarkMode === 'true'; // Only true if explicitly set to 'true'
        const bgColor = isDarkMode ? 'hsl(222, 22%, 8%)' : '#ffffff';
        
        // Set theme attribute immediately so CSS can apply correctly
        if (document.documentElement) {
          if (isDarkMode) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.setAttribute('data-theme', 'light');
            document.documentElement.classList.remove('dark');
          }
          document.documentElement.style.backgroundColor = bgColor;
        }
        
        if (document.body) {
          document.body.style.backgroundColor = bgColor;
        }
        
        // Update loading screen background and styles - only dark if dark mode is explicitly enabled
        if (loadingScreen) {
          if (isDarkMode) {
            loadingScreen.style.backgroundColor = bgColor;
            // Apply dark mode styles to loading screen elements
            const loadingText = loadingScreen.querySelector('.loading-text');
            const loadingTitle = loadingScreen.querySelector('.loading-title');
            const spinnerTrack = loadingScreen.querySelector('.spinner-track');
            const spinnerActive = loadingScreen.querySelector('.spinner-active');
            
            if (loadingText) {
              loadingText.style.color = 'hsl(215, 15%, 70%)';
            }
            if (loadingTitle) {
              loadingTitle.style.background = 'linear-gradient(to right, hsl(210, 30%, 96%), hsl(215, 15%, 70%))';
              loadingTitle.style.webkitBackgroundClip = 'text';
              loadingTitle.style.webkitTextFillColor = 'transparent';
              loadingTitle.style.backgroundClip = 'text';
            }
            if (spinnerTrack) {
              spinnerTrack.style.borderColor = 'hsl(222, 20%, 14%)';
            }
            if (spinnerActive) {
              spinnerActive.style.borderColor = 'hsl(210, 30%, 96%)';
              spinnerActive.style.borderTopColor = 'transparent';
            }
          } else {
            loadingScreen.style.backgroundColor = '#ffffff';
            // Ensure light mode styles are applied
            const loadingText = loadingScreen.querySelector('.loading-text');
            const loadingTitle = loadingScreen.querySelector('.loading-title');
            const spinnerTrack = loadingScreen.querySelector('.spinner-track');
            const spinnerActive = loadingScreen.querySelector('.spinner-active');
            
            if (loadingText) {
              loadingText.style.color = '#475569';
            }
            if (loadingTitle) {
              loadingTitle.style.background = 'linear-gradient(to right, #0f172a, #475569)';
              loadingTitle.style.webkitBackgroundClip = 'text';
              loadingTitle.style.webkitTextFillColor = 'transparent';
              loadingTitle.style.backgroundClip = 'text';
            }
            if (spinnerTrack) {
              spinnerTrack.style.borderColor = '#e2e8f0';
            }
            if (spinnerActive) {
              spinnerActive.style.borderColor = '#0f172a';
              spinnerActive.style.borderTopColor = 'transparent';
            }
          }
        }
        
        console.log('‚úÖ Background set to', isDarkMode ? 'dark' : 'light (default)');
        
        // Ensure root is visible
        if (root) {
          root.style.display = 'block';
          root.style.visibility = 'visible';
          root.style.opacity = '1';
          console.log('‚úÖ Root element made visible');
        }
        
        // Try multiple logo paths for Capacitor compatibility
        const logoImg = document.getElementById('logo-img');
        const logoFallback = document.getElementById('logo-fallback');
        
        if (logoImg) {
          // Function to try loading logo
          const tryLoadLogo = (pathIndex = 0) => {
            const paths = ['/logo.png', './logo.png', 'logo.png', '../public/logo.png'];
            
            if (pathIndex >= paths.length) {
              // All paths failed, show fallback
              logoImg.style.display = 'none';
              if (logoFallback) {
                logoFallback.style.display = 'flex';
              }
              return;
            }
            
            const testImg = new Image();
            testImg.onload = function() {
              // Image loaded successfully, use this path
              logoImg.src = paths[pathIndex];
              logoImg.style.display = 'block';
              if (logoFallback) {
                logoFallback.style.display = 'none';
              }
            };
            testImg.onerror = function() {
              // Try next path after a short delay
              if (pathIndex < paths.length - 1) {
                setTimeout(() => tryLoadLogo(pathIndex + 1), 50);
              } else {
                // All paths failed
                logoImg.style.display = 'none';
                if (logoFallback) {
                  logoFallback.style.display = 'flex';
                }
              }
            };
            testImg.src = paths[pathIndex];
          };
          
          // Start trying to load logo
          tryLoadLogo();
          
          // Also set up error handler as backup
          logoImg.onerror = function() {
            this.style.display = 'none';
            if (logoFallback) {
              logoFallback.style.display = 'flex';
            }
          };
        }
        
        // Fallback: Hide loading screen after 10 seconds if React hasn't loaded
        // This prevents the app from being stuck on loading screen
        setTimeout(function() {
          const loadingScreen = document.getElementById('loading-screen');
          const root = document.getElementById('root');
          if (loadingScreen && loadingScreen.style.display !== 'none') {
            console.warn('‚ö†Ô∏è Fallback: Hiding loading screen after timeout (React may not have loaded)');
            loadingScreen.style.opacity = '0';
            loadingScreen.style.transition = 'opacity 0.3s ease-out';
            setTimeout(function() {
              if (loadingScreen) {
                loadingScreen.style.display = 'none';
              }
              if (root) {
                root.style.display = 'block';
                root.style.visibility = 'visible';
                root.style.opacity = '1';
              }
            }, 300);
          }
        }, 10000); // 10 second timeout
      })();
    </script>
    <script type="module">
      console.log('üì¶ Module script tag executing...');
      try {
        import('/src/main.jsx').then(() => {
          console.log('‚úÖ main.jsx module loaded successfully');
        }).catch((error) => {
          console.error('‚ùå Failed to load main.jsx:', error);
          const loadingScreen = document.getElementById('loading-screen');
          if (loadingScreen) {
            loadingScreen.innerHTML = `<div style="text-align: center; color: red; padding: 2rem;"><p style="font-weight: 600;">Failed to load app</p><p style="margin-top: 0.5rem; font-size: 0.875rem;">${error.message}</p><details style="margin-top: 1rem; text-align: left;"><summary style="cursor: pointer; color: #64748b;">Error details</summary><pre style="margin-top: 0.5rem; font-size: 0.75rem; color: #64748b; overflow: auto;">${error.stack || error}</pre></details></div>`;
          }
        });
      } catch (error) {
        console.error('‚ùå Error importing main.jsx:', error);
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.innerHTML = `<div style="text-align: center; color: red; padding: 2rem;"><p style="font-weight: 600;">Error loading app</p><p style="margin-top: 0.5rem; font-size: 0.875rem;">${error.message}</p></div>`;
        }
      }
    </script>
  </body>
</html>


